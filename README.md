# balance-rating

Апи-сервис, предназначен для получения и обработки данных с ресурса https://api.etherscan.io/api.
Возвращает адрес кошелька, баланс которого изменился больше остальных (по абсолютной величине) за последние 100 блоков.

## Окружение

- Node.js (version 18.16.0)
- npm (version 9.5.1)

## Установка

1. Скачать репозиторий: bash git clone https://github.com/GRD-1/balance-rating.git
2. Установить зависимости. В корне проекта: bash npm install

## Конфигурация

* Переменные окружения лежат тут: _src/ts/config/config.ts
  * используйте process.env.apikey, чтобы назначить новый apikey для запросов к https://api.etherscan.io
  * исользуйте process.env.logTheBenchmarks, чтобы отключить логироване в консоль;

## Запуск 

* для запуска в режиме разработчика: bash npm run start:dev
* для запуска на продакте: bash npm run start:prod

## Использование

* после запуска сервис доступен по локальному адресу: http://localhost:3000
* для получения адреса кошелька, баланс которого изменился больше остальных используйте: http://localhost:3000/max-balance
* количество блоков для анализа можно менять через параметр [blocksAmount] строки запроса, 
например: http://localhost:3000/max-balance?blocksAmount=4 (по умолчанию 100)
* для сравнения производительности метод реализован с использованием разных библиотек для очереди задач.
  параметр строки запроса [queue] позволяет переключаться между ними, например:
  * http://localhost:3000/max-balance?queue=self-written-queue
  * http://localhost:3000/max-balance?queue=npm-queue
  * (по умолчанию используется 'npm queue')

## Примечания к ТЗ

В ТЗ приведены методы обращения к api.etherscan.io без использования парметра [apikey], 
но на стороне ресурса стоит ограничение на количество запросов в мин.
* Для неавтроизованных пользователей разрешенный интервал >= 4.4 сек между запросами. При таком подходе выборка 100 блоков займет ~7.33 мин,
поэтому я создал учетку и добавил свой apikey в запрос. apikey лежит в переменной окружения process.env.apikey


* Для бесплатной учетной записи лимит составляет 5 запросов в мин. Я настроил отправку запросов именно с этой частотой.
сейчас время загрузки транзакций из последних 100 блоков составляет ~25 сек. Не применяя другие методы api.etherscan.io 
сократить это время не получится. Еще можно подключить коммерческую учетную запись.

* чтобы отслеживать статус обработки запроса, а не просто ждать 25 сек, я сознательно оставил вывод логов в консоль

